(function(s,y,h,S,C,w,l){"use strict";function u(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function E(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var a=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,a.get?a:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var o=E(h),k=u(C),O=u(w),v=()=>y.injectCSS(".beef-ms-settings-card-container{display:flex;flex-direction:row;margin-bottom:1rem}.beef-ms-settings-card-container .beef-ms-settings-card{width:100%;padding:20px}.beef-ms-settings-card-container .beef-ms-settings-card h1{margin-bottom:.25rem}.beef-ms-settings-card-container .beef-ms-settings-card .beef-ms-settings-card-description{margin-bottom:2rem}.beef-ms-settings-card-container .beef-ms-settings-card .beef-ms-settings-card-button{position:absolute;bottom:0;right:0;margin:1rem}.beef-ms-settings-card-container .beef-ms-settings-card:first-child{margin-right:.5rem}");function R(e,n){let t=document.createElement("a");t.href=`data:,${encodeURIComponent(e)}`,t.setAttribute("download",n),t.click(),t.remove()}async function j(){return new Promise((e,n)=>{let t=document.createElement("input");t.setAttribute("accept","application/json"),t.setAttribute("type","file"),t.addEventListener("change",async()=>{e(await t.files[0].text())},!1),t.click()})}const[r,d,m,g,{SingleSelect:P},{showToast:i}]=S.batchFind(({findByProps:e,findByDisplayName:n})=>{e("Sizes","Colors","Looks","DropdownSizes"),n("Card"),n("FormText"),n("FormTitle"),n("Select",!1),e("showToast")});async function p(){let e=[];for(const[n,t]of Object.entries(O.default.store||{})){let a={name:t.manifest.name,enabled:t.enabled,url:n},c=await k.default.get(`${n}_CUMCORD_STORE`);c&&(a.settings=c),e.push(a)}return e}async function f(e,n=i){for(let t of e)if(t.settings&&await cumcord.modules.internal.idbKeyval.set(`${t.url}_CUMCORD_STORE`,t.settings),cumcord.plugins.installed.ghost[t.url])try{cumcord.plugins.togglePlugin(t.url),cumcord.plugins.togglePlugin(t.url)}catch(a){cumcord.utils.logger.error("[MigrationStation]","Could not reload plugin",t.name,a),n({message:`Could not reload ${t.name}, check the console.`,id:`ms-${t.url}-err`,type:2})}else{try{await cumcord.plugins.importPlugin(t.url)}catch(a){cumcord.utils.logger.error("[MigrationStation]","Could not load plugin",t.url,a),n({message:`Could not load ${t.name}, check the console.`,id:`ms-${t.url}-err`,type:2})}t.enabled==!1&&cumcord.plugins.togglePlugin(t.url)}n({message:"Finished loading backup!",id:"ms-finish",type:1})}async function T(e){return`(${f})(${JSON.stringify(e??await p())}, cumcord.modules.webpack.findByProps("showToast").showToast)`}function b({children:e,title:n,description:t}){return o.createElement(o.Fragment,null,o.createElement(d,{type:d.Types.PRIMARY,className:"beef-ms-settings-card"},o.createElement(g,{tag:g.Tags.H1},n),o.createElement(m,{className:"beef-ms-settings-card-description",type:m.Types.DESCRIPTION},t),e))}function M({text:e,color:n,size:t,look:a,func:c}){return o.createElement(r,{color:r.Colors[n]||r.Colors.BRAND,size:r.Sizes[t]||r.Sizes.SMALL,look:r.Looks[a]||r.Looks.FILLED,className:"beef-ms-settings-card-button",onClick:c},e)}function F(){return o.createElement(o.Fragment,null,o.createElement("style",null,`
                .cumcord-settings-modal {
                    min-width: auto;
                    min-height: auto;
                }
            `),o.createElement("div",{className:"beef-ms-settings-card-container"},o.createElement(b,{title:"Backup",description:"Creates a backup of your current installation, including plugins and plugin nests."},o.createElement(P,{options:[{label:"Download as JSON",value:0},{label:"Copy as snippet",value:1}],placeholder:"Choose your backup method",onChange:async e=>{if(e===0)R(JSON.stringify(await p()),`backup-${Date.now()}.json`);else try{await l.copyText(await T())}catch(n){i({message:"Could not copy to clipboard! :(",id:"ms-clipboard-error",type:2}),l.logger.error("[MigrationStation]","Could not copy to clipboard",n)}finally{i({message:"Snippet was copied to clipboard successfully!",id:"ms-clipboard-success",type:1})}},isDisabled:!1})),o.createElement(b,{title:"Restore",description:"Restores from a backup of your current installation."},o.createElement(M,{text:"Restore",size:"MEDIUM",func:async()=>{let e;try{e=JSON.parse(await j())}catch(n){i({message:"Could not open backup! :(",id:"ms-backup-error",type:2}),l.logger.error("[MigrationStation]","Could not open backup",n)}finally{f(e)}}}))))}const N=[v()];function D(){_.forEachRight(N,e=>e())}return s.onUnload=D,s.settings=F,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.modules.internal.idbKeyval,cumcord.plugins.installed,cumcord.utils);
