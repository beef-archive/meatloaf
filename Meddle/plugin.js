(function(g,o,u,p,h,P,k,L,Oe,Y,$,W){"use strict";function H(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function J(e){if(e&&e.__esModule)return e;var s=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var l=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(s,r,l.get?l:{enumerable:!0,get:function(){return e[r]}})}}),s.default=e,Object.freeze(s)}var t=J(P),d=H(Y);const[Re,f,c,m,E,a,S,T,K,q,Q,A,C,I,X,Z,{GuildFeatures:ze},{joinGuild:B},{findActivity:ee},{ActivityTypes:te},{SpotifyAPI:re},{SpotifyEndpoints:se},{SpotifySocket:ie},{getActiveSocketAndDevice:M,shouldShowActivity:le},{getChannel:N},{getGuild:F},{getCurrentUser:j},[,{getUser:O}],{getMessage:ne},{getToken:oe}]=u.batchFind(({findByProps:e,findByPropsAll:s,findByDisplayName:r})=>{r("SettingsView"),r("FormTitle"),r("FormText"),r("FormDivider"),r("Switch"),e("Sizes","Colors","Looks","DropdownSizes"),r("TextInput"),r("TabBar"),e("topPill"),e("tabBar","nowPlayingColumn"),r("UserActivityContainer"),e("userPopout","body"),e("activity","note"),e("scrollerBase","thin"),e("contentImagesProfile"),r("Slider"),e("GuildFeatures"),e("joinGuild"),e("getApplicationActivities"),e("ActivityTypes"),e("SpotifyAPI"),e("SpotifyEndpoints"),e("SpotifySocket"),e("getActiveSocketAndDevice"),e("hasChannel"),e("getGuild"),e("getCurrentUser"),s("getUser"),e("getMessages"),e("getToken")}),ae={modules:{getChannel:N,getGuild:F,getCurrentUser:j,getUser:O,getMessage:ne,getToken:oe}};function R(){return o.persist.ghost.generalExposeObject&&!window.Meddle?window.Meddle=ae:!o.persist.ghost.generalExposeObject&&window.Meddle&&delete window.Meddle,()=>{delete window.Meddle}}function de(e){return t.createElement("div",null,t.createElement(f,{style:{marginBottom:"0.2rem"},tag:"h1"},"Meddle"),t.createElement(c,null,"A tool for those who like to mess with the Maze."))}function ce({items:e}){let[s,r]=t.useState(0);return t.createElement("div",null,t.createElement("div",{className:"beef-meddle-card"},t.createElement(de,null),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement(T,{type:K.topPill,className:q.tabBar,selectedItem:s,onItemSelect:r},e.map((l,n)=>t.createElement(T.Item,{id:n},l.text)))),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-settings-section beef-meddle-card"},t.createElement(k.ErrorBoundary,null,t.createElement(e[s].component,{goTo:r}))))}function me({text:e,subtext:s,checked:r,onChange:l}){return t.createElement("div",{class:"beef-meddle-switch"},t.createElement(E,{checked:r,onChange:l}),t.createElement(c,null,e,t.createElement(c,{class:"beef-meddle-subtext"},s)))}function ue(e){return t.createElement("div",null,t.createElement(me,{text:"Expose a Meddle object on the window",subtext:"This contains several utilities such as some common Webpack modules.",checked:o.persist.ghost.generalExposeObject,onChange:s=>{o.persist.store.generalExposeObject=s,R()}}))}const z=u.findByDisplayName("FormText"),fe=u.findByDisplayName("Switch"),pe=u.findByDisplayName("TextInput");u.findByDisplayName("Select",!1).SingleSelect;const U=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),he=({k:e,depends:s,children:r})=>d.default.createElement("div",{style:U(s)},d.default.createElement(fe,{checked:o.persist.ghost[e],disabled:s!==void 0&&!o.persist.ghost[s],onChange:l=>o.persist.store[e]=l}),d.default.createElement(z,{children:r})),ve=({k:e,depends:s,children:r})=>d.default.createElement("div",{style:U(s)},d.default.createElement(pe,{value:o.persist.ghost[e],disabled:s!==void 0&&!o.persist.ghost[s],onChange:l=>o.persist.store[e]=l}),d.default.createElement(z,{children:r})),be=e=>s=>(L.useNest(o.persist),e(s)),ge=(e,s=o.persist)=>{for(const r in e)s.ghost[r]===void 0&&(s.store[r]=e[r])};function y({k:e,depends:s,children:r}){return t.createElement("div",{class:"beef-meddle-persist-textbox-wrapper"},t.createElement(ve,{k:e,depends:s},r))}function x({k:e,depends:s,children:r}){return t.createElement("div",{class:"beef-meddle-persist-switch-wrapper"},t.createElement(he,{k:e,depends:s},r))}function Ee(e){return t.createElement("div",null,t.createElement("div",{class:"beef-meddle-column"},t.createElement(x,{k:"dispatchLogEnabled"},"Log all FluxDispatcher calls to console"),t.createElement(x,{k:"dispatchWhiteListMode"},"Dispatch logger whitelist mode")),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-column"},t.createElement(y,{k:"dispatchIgnoreList"},"FluxDispatcher calls to hide when not in whitelist mode (comma separated)"),t.createElement(y,{k:"dispatchWhiteList"},"FluxDispatcher calls to allow when in whitelist mode (comma separated)")))}function Se({text:e,color:s,size:r,look:l,func:n,style:b}){return t.createElement(a,{style:b,color:a.Colors[s]||a.Colors.BRAND,size:a.Sizes[r]||a.Sizes.SMALL,look:a.Looks[l]||a.Looks.FILLED,onClick:n},e)}function ye(e){return t.createElement("div",null,t.createElement(y,{k:"serverId"},"Server ID"),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-row"},t.createElement(x,{k:"serverLurkMode"},"Join as lurker"),t.createElement(Se,{style:{marginLeft:"auto"},text:"Join",size:"SMALL",func:async()=>{B(o.persist.ghost.serverId,{lurker:o.persist.ghost.serverLurkMode})}})))}const w=[],i=$.nests.make({overrides:{title:{value:"",enabled:!1},artists:{value:"",enabled:!1},album:{value:"",enabled:!1},cover:{value:"",enabled:!1},time:{position:0,duration:0,enabled:!1}}});function G(e){i.store.playerState=e,e?.item&&(i.ghost.overrides.title.enabled||(i.store.overrides.title.value=i.ghost.playerState.item.name),i.ghost.overrides.artists.enabled||(i.store.overrides.artists.value=i.ghost.playerState.item.artists.map(s=>s.name).join(", ")),i.ghost.overrides.album.enabled||(i.store.overrides.album.value=i.ghost.playerState.item.album.name),i.ghost.overrides.cover.enabled||(i.store.overrides.cover.value=i.ghost.playerState.item.album.images[0].url),i.ghost.overrides.time.enabled||(i.store.overrides.time.position=i.ghost.playerState.progress_ms,i.store.overrides.time.duration=i.ghost.playerState.item.duration_ms))}function xe(){return V(),w.push(h.instead("handleEvent",ie.prototype,([e],s)=>{if(e.type==="PLAYER_STATE_CHANGED"&&e.event!==null){if(G(e.event?.state),i.ghost.overrides.title.enabled&&(e.event.state.item.name=i.ghost.overrides.title.value),i.ghost.overrides.artists.enabled){const r=i.ghost.overrides.artists.value.split(",").map(n=>n.trim()),l=e.event.state.item.artists;for(const n in r)l[n]||(l[n]={}),l[n].name=r[n];l.length>r.length&&l.splice(r.length,l.length-r.length)}i.ghost.overrides.album.enabled&&(e.event.state.item.album.name=i.ghost.overrides.album.value),i.ghost.overrides.cover.enabled&&(e.event.state.item.album.images[0].url=i.ghost.overrides.cover.value),i.ghost.overrides.time.enabled&&(e.event.state.item.duration_ms=i.ghost.overrides.time.duration,e.event.state.progress_ms=i.ghost.overrides.time.position)}s.apply(this,[e])})),w.push(h.instead("dispatch",p.FluxDispatcher,([e],s)=>{e.type==="SPOTIFY_PLAYER_STATE"&&e.track===null||s.apply(this,[e])})),()=>_.forEachRight(w,e=>e())}function V(){const e=M()?.socket;e&&re.get(e.accountId,e.accessToken,{url:se.PLAYER}).then(s=>G(s?.body))}function we(){const e=M()?.socket;e&&e.handleEvent({type:"PLAYER_STATE_CHANGED",event:{state:i.ghost.playerState}})}function ke(){L.useNest(i);const[e,s]=t.useReducer(n=>~n,0),[r,l]=t.useReducer(n=>~n,0);return t.useEffect(()=>{function n(){s()}function b(){l()}return p.FluxDispatcher.subscribe("SPOTIFY_PLAYER_STATE",n),i.on("SET",b),()=>{p.FluxDispatcher.unsubscribe("SPOTIFY_PLAYER_STATE",n),i.off("SET",b)}},[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"beef-meddle-spotify"},t.createElement("img",{className:"beef-meddle-spotify-cover",src:i.ghost.overrides.cover.value}),t.createElement("div",{className:"beef-meddle-spotify-details"},t.createElement(v,{id:"title"},"Title"),t.createElement(v,{id:"artists"},"Artists (comma-separated)"),t.createElement(v,{id:"album"},"Album"))),t.createElement(f,null,"Progress"),t.createElement(Z,{className:"beef-meddle-spotify-slider-input",minValue:0,maxValue:Math.abs(i.ghost.overrides.time.duration),initialValue:i.store.overrides.time.position,handleSize:1,keyboardStep:1,onValueChange:n=>i.store.overrides.time.position=Math.floor(n||0),onValueRender:D,onMarkerRender:D,disabled:!i.ghost.overrides.time.enabled,key:r}),t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(f,null,"Duration (Seconds)"),t.createElement("div",null,t.createElement(S,{className:"beef-meddle-spotify-override-input",value:Math.floor(i.ghost.overrides.time.duration/1e3),onChange:n=>i.store.overrides.time.duration=(parseInt(n)||0)*1e3,disabled:!i.ghost.overrides.time.enabled}),t.createElement(E,{checked:i.ghost.overrides.time.enabled,onChange:n=>i.store.overrides.time.enabled=n}))),t.createElement(v,{id:"cover"},"Cover URL"),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-spotify-post-divider"},t.createElement("div",{className:"beef-meddle-spotify-actions"},t.createElement(a,{size:a.Sizes.SMALL,onClick:()=>we()},"Force update"),t.createElement(a,{size:a.Sizes.SMALL,onClick:()=>V()},"Refresh data")),le()&&t.createElement("div",{className:`beef-meddle-spotify-preview ${[A.userPopout,A.body,I.scrollerBase,I.thin,C.bodyInnerWrapper,C.activity,X.activityUserPopout].join(" ")}`},t.createElement(Q,{key:e,type:"UserPopout",user:j(),activity:ee(n=>n.type===te.LISTENING)}))))}function D(e){return`${Math.floor(e/6e4)}m${Intl.NumberFormat(void 0,{minimumIntegerDigits:2}).format(Math.floor(e/1e3%60))}s`}function v(e){return t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(f,null,e.children),t.createElement("div",null,t.createElement(S,{className:"beef-meddle-spotify-override-input",value:i.ghost.overrides[e.id].value,onChange:s=>i.store.overrides[e.id].value=s,disabled:!i.ghost.overrides[e.id].enabled}),t.createElement(E,{checked:i.ghost.overrides[e.id].enabled,onChange:s=>i.store.overrides[e.id].enabled=s})))}function Le({object:e}){return typeof e=="object"?t.createElement("div",null,t.createElement("div",{className:"beef-meddle-column"},Object.entries(e).map(([s,r])=>{let l;switch(typeof r){case"string":l=r.length>0?r:"empty string";break;case"number":l=r.toString();break;case"boolean":l=r.toString();break;case"object":l=JSON.stringify(r);break;case"undefined":l="undefined"}return t.createElement("div",null,t.createElement(f,{style:{textTransform:"none",userSelect:"all"},tag:"h4"},t.createElement("code",null,s)),t.createElement(c,{style:{userSelect:"all"}},t.createElement("code",null,l)))}))):t.createElement(c,null,"Unable to resolve given snowflake.")}function Te({value:e,onChange:s,variant:r="column",fixedWidth:l,children:n}){if(r!=="column"&&r!=="row")throw new Error("Component Error - Textbox: variant should be column (default) or row");return t.createElement("div",{class:r==="column"?"beef-meddle-column":"beef-meddle-row beef-meddle-center"},t.createElement(c,{style:l?{width:l}:{}},n),t.createElement(S,{value:e,onChange:s}))}function Ae(e){const s=O(e);if(s)return s;const r=N(e);if(r)return r;const l=F(e);if(l)return l}function Ce(e){let[s,r]=t.useState("");return t.createElement("div",null,t.createElement(Te,{value:s,onChange:l=>{r(l)}},"Snowflake (can be the ID of a user, guild or channel)"),t.createElement(m,{className:"beef-meddle-divider"}),t.createElement(Le,{object:Ae(s)}))}function Ie(e){return t.createElement(k.ErrorBoundary,null,t.createElement("div",{className:"beef-meddle-settings"},t.createElement(ce,{items:[{text:"General",component:ue},{text:"FluxDispatcher",component:Ee},{text:"Servers",component:ye},{text:"Spotify",component:ke},{text:"Snowflake",component:Ce}]})))}var Me=()=>W.registerSection("MEDDLE","Meddle",be(Ie));function Ne(){return h.after("dispatch",p.FluxDispatcher,e=>{!o.persist.ghost.dispatchLogEnabled||o.persist.ghost.dispatchWhiteListMode&&!o.persist.ghost.dispatchWhiteList.split(",").includes(e[0].type)||o.persist.ghost.dispatchIgnoreList.split(",").includes(e[0].type)||console.log(e[0])})}var Fe=()=>h.injectCSS(".beef-meddle-row{display:flex;gap:.5rem}.beef-meddle-column{display:flex;flex-direction:column;gap:.5rem}.beef-meddle-divider{margin-top:.5rem;margin-bottom:.5rem}.beef-meddle-subtext{font-size:x-small;color:var(--text-muted)}.beef-meddle-card{padding:1rem;border-radius:.5rem;background-color:var(--background-secondary)}.beef-meddle-center{display:flex;justify-content:center;align-items:center}.beef-meddle-fullwidth,.beef-meddle-fullwidth *{width:100%}.beef-meddle-persist-textbox-wrapper *{display:flex;flex-direction:column-reverse}.beef-meddle-persist-textbox-wrapper * *{width:100%}.beef-meddle-persist-switch-wrapper{display:flex}.beef-meddle-persist-switch-wrapper *{margin-bottom:0!important;align-items:center}.beef-meddle-switch{display:flex;align-items:center;gap:.5rem}.beef-meddle-spotify{display:flex;align-items:center}.beef-meddle-spotify-cover{width:120px;height:120px}.beef-meddle-spotify-details{margin-left:10px;width:100%}.beef-meddle-spotify-override{margin-bottom:8px}.beef-meddle-spotify-override div{display:flex;align-items:center}.beef-meddle-spotify-override input{width:100%}.beef-meddle-spotify-override-input{flex-grow:1;margin-right:12px}.beef-meddle-spotify-post-divider{display:flex}.beef-meddle-spotify-actions{display:block}.beef-meddle-spotify-actions button{margin-bottom:8px;width:100%}.beef-meddle-spotify-preview{width:300px;padding-top:16px;margin-left:auto}.beef-meddle-spotify-preview div img{top:16px!important;right:16px!important}");ge({dispatchLogEnabled:!1,dispatchIgnoreList:"",dispatchWhiteList:"",dispatchWhiteListMode:!1,serverId:"",serverLurkMode:!1,generalExposeObject:!0});const _e=[R(),Me(),Ne(),xe(),Fe()];function je(){_.forEachRight(_e,e=>e())}return g.onUnload=je,Object.defineProperty(g,"__esModule",{value:!0}),g})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.React,cumcord.ui.components,cumcord.utils,cumcord.plugins,cumcord.modules.common.React,cumcord.modules.internal,cumcord.ui.userSettings);
