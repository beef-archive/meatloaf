(function(v,n,m,h,D,k,L,$e,O,G,W){"use strict";function V(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function Y(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(i){if(i!=="default"){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:function(){return e[i]}})}}),r.default=e,Object.freeze(r)}var t=Y(D),c=V(O);const[Re,g,p,b,u,y,d,A,T,H,J,q,N,C,M,K,Q,{GuildFeatures:Ue},{joinGuild:X},{findActivity:Z},{ActivityTypes:ee},{SpotifyAPI:te},{SpotifyEndpoints:re},{SpotifySocket:se},{getActiveSocketAndDevice:I,shouldShowActivity:ie},{getChannel:oe},{getGuild:ne},{getCurrentUser:P},[,{getUser:le}],{getMessage:ae},{getToken:de}]=m.batchFind(({findByProps:e,findByPropsAll:r,findByDisplayName:i})=>{i("SettingsView"),e("dirtyDispatch"),i("FormTitle"),i("FormText"),i("FormDivider"),i("Switch"),e("Sizes","Colors","Looks","DropdownSizes"),i("TextInput"),i("TabBar"),e("topPill"),e("tabBar","nowPlayingColumn"),i("UserActivityContainer"),e("userPopout","body"),e("activity","note"),e("scrollerBase","thin"),e("contentImagesProfile"),i("Slider"),e("GuildFeatures"),e("joinGuild"),e("getApplicationActivities"),e("ActivityTypes"),e("SpotifyAPI"),e("SpotifyEndpoints"),e("SpotifySocket"),e("getActiveSocketAndDevice"),e("hasChannel"),e("getGuild"),e("getCurrentUser"),r("getUser"),e("getMessages"),e("getToken")}),ce={modules:{getChannel:oe,getGuild:ne,getCurrentUser:P,getUser:le,getMessage:ae,getToken:de}};function F(){return n.persist.ghost.generalExposeObject&&!window.Meddle?window.Meddle=ce:!n.persist.ghost.generalExposeObject&&window.Meddle&&delete window.Meddle,()=>{delete window.Meddle}}function me(e){return t.createElement("div",null,t.createElement(p,{style:{marginBottom:"0.2rem"},tag:"h1"},"Meddle"),t.createElement(b,null,"A tool for those who like to mess with the Maze."))}function ue({items:e}){let[r,i]=t.useState(0);return t.createElement("div",null,t.createElement("div",{className:"beef-meddle-card"},t.createElement(me,null),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement(T,{type:H.topPill,className:J.tabBar,selectedItem:r,onItemSelect:i},e.map((o,l)=>t.createElement(T.Item,{id:l},o.text)))),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-settings-section beef-meddle-card"},t.createElement(k.ErrorBoundary,null,t.createElement(e[r].component,{goTo:i}))))}function pe({text:e,subtext:r,checked:i,onChange:o}){return t.createElement("div",{class:"beef-meddle-switch"},t.createElement(y,{checked:i,onChange:o}),t.createElement(b,null,e,t.createElement(b,{class:"beef-meddle-subtext"},r)))}function fe(e){return t.createElement("div",null,t.createElement(pe,{text:"Expose a Meddle object on the window",subtext:"This contains several utilities such as some common Webpack modules.",checked:n.persist.ghost.generalExposeObject,onChange:r=>{n.persist.store.generalExposeObject=r,F()}}))}const B=m.findByDisplayName("FormText"),ve=m.findByDisplayName("Switch"),he=m.findByDisplayName("TextInput");m.findByDisplayName("Select",!1).SingleSelect;const j=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),ge=({k:e,depends:r,children:i})=>c.default.createElement("div",{style:j(r)},c.default.createElement(ve,{checked:n.persist.ghost[e],disabled:r!==void 0&&!n.persist.ghost[r],onChange:o=>n.persist.store[e]=o}),c.default.createElement(B,{children:i})),be=({k:e,depends:r,children:i})=>c.default.createElement("div",{style:j(r)},c.default.createElement(he,{value:n.persist.ghost[e],disabled:r!==void 0&&!n.persist.ghost[r],onChange:o=>n.persist.store[e]=o}),c.default.createElement(B,{children:i})),ye=e=>r=>(L.useNest(n.persist),e(r)),Ee=(e,r=n.persist)=>{for(const i in e)r.ghost[i]===void 0&&(r.store[i]=e[i])};function E({k:e,depends:r,children:i}){return t.createElement("div",{class:"beef-meddle-persist-textbox-wrapper"},t.createElement(be,{k:e,depends:r},i))}function S({k:e,depends:r,children:i}){return t.createElement("div",{class:"beef-meddle-persist-switch-wrapper"},t.createElement(ge,{k:e,depends:r},i))}function Se(e){return t.createElement("div",null,t.createElement("div",{class:"beef-meddle-column"},t.createElement(S,{k:"dispatchLogEnabled"},"Log all FluxDispatcher calls to console"),t.createElement(S,{k:"dispatchWhiteListMode"},"Dispatch logger whitelist mode")),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-column"},t.createElement(E,{k:"dispatchIgnoreList"},"FluxDispatcher calls to hide when not in whitelist mode (comma separated)"),t.createElement(E,{k:"dispatchWhiteList"},"FluxDispatcher calls to allow when in whitelist mode (comma separated)")))}function xe({text:e,color:r,size:i,look:o,func:l,style:w}){return t.createElement(d,{style:w,color:d.Colors[r]||d.Colors.BRAND,size:d.Sizes[i]||d.Sizes.SMALL,look:d.Looks[o]||d.Looks.FILLED,onClick:l},e)}function we(e){return t.createElement("div",null,t.createElement(E,{k:"serverId"},"Server ID"),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-row"},t.createElement(S,{k:"serverLurkMode"},"Join as lurker"),t.createElement(xe,{style:{marginLeft:"auto"},text:"Join",size:"SMALL",func:async()=>{X(n.persist.ghost.serverId,{lurker:n.persist.ghost.serverLurkMode})}})))}const s=G.nests.make({overrides:{title:{value:"",enabled:!1},artists:{value:"",enabled:!1},album:{value:"",enabled:!1},cover:{value:"",enabled:!1},time:{position:0,duration:0,enabled:!1}}});function $(e){s.store.playerState=e,!!e?.item&&(s.ghost.overrides.title.enabled||(s.store.overrides.title.value=s.ghost.playerState.item.name),s.ghost.overrides.artists.enabled||(s.store.overrides.artists.value=s.ghost.playerState.item.artists.map(r=>r.name).join(", ")),s.ghost.overrides.album.enabled||(s.store.overrides.album.value=s.ghost.playerState.item.album.name),s.ghost.overrides.cover.enabled||(s.store.overrides.cover.value=s.ghost.playerState.item.album.images[0].url),s.ghost.overrides.time.enabled||(s.store.overrides.time.position=s.ghost.playerState.progress_ms,s.store.overrides.time.duration=s.ghost.playerState.item.duration_ms))}function ke(){return R(),h.instead("handleEvent",se.prototype,([e],r)=>{if(e.type==="PLAYER_STATE_CHANGED"&&e.event!==null){if($(e.event?.state),s.ghost.overrides.title.enabled&&(e.event.state.item.name=s.ghost.overrides.title.value),s.ghost.overrides.artists.enabled){const i=s.ghost.overrides.artists.value.split(",").map(l=>l.trim()),o=e.event.state.item.artists;for(const l in i)o[l]||(o[l]={}),o[l].name=i[l];o.length>i.length&&o.splice(i.length,o.length-i.length)}s.ghost.overrides.album.enabled&&(e.event.state.item.album.name=s.ghost.overrides.album.value),s.ghost.overrides.cover.enabled&&(e.event.state.item.album.images[0].url=s.ghost.overrides.cover.value),s.ghost.overrides.time.enabled&&(e.event.state.item.duration_ms=s.ghost.overrides.time.duration,e.event.state.progress_ms=s.ghost.overrides.time.position)}r.apply(this,[e])})}function R(){const e=I()?.socket;e&&te.get(e.accountId,e.accessToken,{url:re.PLAYER}).then(r=>$(r?.body))}function Le(){const e=I()?.socket;e&&e.handleEvent({type:"PLAYER_STATE_CHANGED",event:{state:s.ghost.playerState}})}function Ae(){L.useNest(s);const[e,r]=t.useState(x(s.ghost.overrides.time.duration)),[i,o]=t.useReducer(a=>~a,0),[l,w]=t.useReducer(a=>~a,0);return t.useEffect(()=>{function a(){o()}function z(ze,{path:Be,value:je}){Be.join(".")==="overrides.time.duration"&&!s.ghost.overrides.time.enabled&&r(x(je)),w()}return g.subscribe("SPOTIFY_PLAYER_STATE",a),s.on("SET",z),()=>{g.unsubscribe("SPOTIFY_PLAYER_STATE",a),s.off("SET",z)}},[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"beef-meddle-spotify"},t.createElement("img",{className:"beef-meddle-spotify-cover",src:s.ghost.overrides.cover.value}),t.createElement("div",{className:"beef-meddle-spotify-details"},t.createElement(f,{id:"title"},"Title"),t.createElement(f,{id:"artists"},"Artists (comma-separated)"),t.createElement(f,{id:"album"},"Album"))),t.createElement(p,null,"Progress"),t.createElement(Q,{className:"beef-meddle-spotify-slider-input",minValue:0,maxValue:s.ghost.overrides.time.duration,initialValue:s.store.overrides.time.position,handleSize:1,keyboardStep:1,onValueChange:a=>s.store.overrides.time.position=Math.floor(a||0),onValueRender:U,onMarkerRender:U,disabled:!s.ghost.overrides.time.enabled,key:l}),t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(p,null,"Duration (formatted as mm:ss)"),t.createElement("div",null,t.createElement(A,{className:"beef-meddle-spotify-override-input",value:e,onChange:r,onBlur:()=>r(x(s.store.overrides.time.duration=Te(e))),disabled:!s.ghost.overrides.time.enabled}),t.createElement(y,{checked:s.ghost.overrides.time.enabled,onChange:a=>s.store.overrides.time.enabled=a}))),t.createElement(f,{id:"cover"},"Cover URL"),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-spotify-post-divider"},t.createElement("div",{className:"beef-meddle-spotify-actions"},t.createElement(d,{size:d.Sizes.SMALL,onClick:()=>Le()},"Force update"),t.createElement(d,{size:d.Sizes.SMALL,onClick:()=>R()},"Refresh data")),ie()&&t.createElement("div",{className:`beef-meddle-spotify-preview ${[N.userPopout,N.body,M.scrollerBase,M.thin,C.bodyInnerWrapper,C.activity,K.activityUserPopout].join(" ")}`},t.createElement(q,{key:i,type:"UserPopout",user:P(),activity:Z(a=>a.type===ee.LISTENING)}))))}function U(e){return`${Math.floor(e/6e4)}m${Intl.NumberFormat(void 0,{minimumIntegerDigits:2}).format(Math.floor(e/1e3%60))}s`}function x(e){return`${Math.floor(e/6e4)}:${Intl.NumberFormat(void 0,{minimumIntegerDigits:2}).format(Math.floor(e/1e3%60))}`}function Te(e){const r=Ne(e.split(":").filter(i=>!!i).map(i=>parseInt(i)),2);return(r[0]*60+r[1])*1e3||1e3}const Ne=(e,r)=>Array(r).fill(0).concat(e).slice(-Math.max(r,e.length));function f(e){return t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(p,null,e.children),t.createElement("div",null,t.createElement(A,{className:"beef-meddle-spotify-override-input",value:s.ghost.overrides[e.id].value,onChange:r=>s.store.overrides[e.id].value=r,disabled:!s.ghost.overrides[e.id].enabled}),t.createElement(y,{checked:s.ghost.overrides[e.id].enabled,onChange:r=>s.store.overrides[e.id].enabled=r})))}function Ce(e){return t.createElement(k.ErrorBoundary,null,t.createElement("div",{className:"beef-meddle-settings"},t.createElement(ue,{items:[{text:"General",component:fe},{text:"FluxDispatcher",component:Se},{text:"Servers",component:we},{text:"Spotify",component:Ae}]})))}var Me=()=>W.registerSection("MEDDLE","Meddle",ye(Ce));function Ie(){return h.after("dispatch",g,e=>{!n.persist.ghost.dispatchLogEnabled||n.persist.ghost.dispatchWhiteListMode&&!n.persist.ghost.dispatchWhiteList.split(",").includes(e[0].type)||n.persist.ghost.dispatchIgnoreList.split(",").includes(e[0].type)||console.log(e[0])})}var Pe=()=>h.injectCSS(".beef-meddle-row{display:flex;gap:.5rem}.beef-meddle-column{display:flex;flex-direction:column;gap:.5rem}.beef-meddle-divider{margin-top:.5rem;margin-bottom:.5rem}.beef-meddle-subtext{font-size:x-small;color:var(--text-muted)}.beef-meddle-card{padding:1rem;border-radius:.5rem;background-color:var(--background-secondary)}.beef-meddle-center{display:flex;justify-content:center;align-items:center}.beef-meddle-fullwidth{width:100%}.beef-meddle-fullwidth *{width:100%}.beef-meddle-persist-textbox-wrapper *{display:flex;flex-direction:column-reverse}.beef-meddle-persist-textbox-wrapper * *{width:100%}.beef-meddle-persist-switch-wrapper{display:flex}.beef-meddle-persist-switch-wrapper *{margin-bottom:0!important;align-items:center}.beef-meddle-switch{display:flex;align-items:center;gap:.5rem}.beef-meddle-spotify{display:flex;align-items:center}.beef-meddle-spotify-cover{width:120px;height:120px}.beef-meddle-spotify-details{margin-left:10px;width:100%}.beef-meddle-spotify-override{margin-bottom:8px}.beef-meddle-spotify-override div{display:flex;align-items:center}.beef-meddle-spotify-override input{width:100%}.beef-meddle-spotify-override-input{flex-grow:1;margin-right:12px}.beef-meddle-spotify-post-divider{display:flex}.beef-meddle-spotify-actions{display:block}.beef-meddle-spotify-actions button{margin-bottom:8px;width:100%}.beef-meddle-spotify-preview{width:300px;padding-top:16px;margin-left:auto}.beef-meddle-spotify-preview div img{top:16px!important;right:16px!important}");Ee({dispatchLogEnabled:!1,dispatchIgnoreList:"",dispatchWhiteList:"",dispatchWhiteListMode:!1,serverId:"",serverLurkMode:!1,generalExposeObject:!0});const Fe=[F(),Me(),Ie(),ke(),Pe()];function _e(){_.forEachRight(Fe,e=>e())}return v.onUnload=_e,Object.defineProperty(v,"__esModule",{value:!0}),v})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.patcher,cumcord.modules.common.React,cumcord.ui.components,cumcord.utils,cumcord.plugins,cumcord.modules.common.React,cumcord.modules.internal,cumcord.ui.userSettings);
