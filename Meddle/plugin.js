(function(h,n,f,b,g,W,L,T,De,Y,H,J){"use strict";function K(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function q(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(s){if(s!=="default"){var l=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,l.get?l:{enumerable:!0,get:function(){return e[s]}})}}),r.default=e,Object.freeze(r)}var t=q(W),c=K(Y);const[$e,p,m,u,E,d,S,A,Q,X,Z,M,I,C,B,ee,{GuildFeatures:Pe},{joinGuild:te},{findActivity:re},{ActivityTypes:se},{SpotifyAPI:ie},{SpotifyEndpoints:le},{SpotifySocket:ne},{getActiveSocketAndDevice:N,shouldShowActivity:oe},{getChannel:F},{getGuild:j},{getCurrentUser:O},[,{getUser:R}],{getMessage:ae},{getToken:de}]=f.batchFind(({findByProps:e,findByPropsAll:r,findByDisplayName:s})=>{s("SettingsView"),s("FormTitle"),s("FormText"),s("FormDivider"),s("Switch"),e("Sizes","Colors","Looks","DropdownSizes"),s("TextInput"),s("TabBar"),e("topPill"),e("tabBar","nowPlayingColumn"),s("UserActivityContainer"),e("userPopout","body"),e("activity","note"),e("scrollerBase","thin"),e("contentImagesProfile"),s("Slider"),e("GuildFeatures"),e("joinGuild"),e("getApplicationActivities"),e("ActivityTypes"),e("SpotifyAPI"),e("SpotifyEndpoints"),e("SpotifySocket"),e("getActiveSocketAndDevice"),e("hasChannel"),e("getGuild"),e("getCurrentUser"),r("getUser"),e("getMessages"),e("getToken")}),ce={modules:{getChannel:F,getGuild:j,getCurrentUser:O,getUser:R,getMessage:ae,getToken:de}};function z(){return n.persist.ghost.generalExposeObject&&!window.Meddle?window.Meddle=ce:!n.persist.ghost.generalExposeObject&&window.Meddle&&delete window.Meddle,()=>{delete window.Meddle}}function me(e){return t.createElement("div",null,t.createElement(p,{style:{marginBottom:"0.2rem"},tag:"h1"},"Meddle"),t.createElement(m,null,"A tool for those who like to mess with the Maze."))}function ue({items:e}){let[r,s]=t.useState(0);return t.createElement("div",null,t.createElement("div",{className:"beef-meddle-card"},t.createElement(me,null),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement(A,{type:Q.topPill,className:X.tabBar,selectedItem:r,onItemSelect:s},e.map((l,o)=>t.createElement(A.Item,{id:o},l.text)))),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-settings-section beef-meddle-card"},t.createElement(L.ErrorBoundary,null,t.createElement(e[r].component,{goTo:s}))))}function fe({text:e,subtext:r,checked:s,onChange:l}){return t.createElement("div",{class:"beef-meddle-switch"},t.createElement(E,{checked:s,onChange:l}),t.createElement(m,null,e,t.createElement(m,{class:"beef-meddle-subtext"},r)))}function pe(e){return t.createElement("div",null,t.createElement(fe,{text:"Expose a Meddle object on the window",subtext:"This contains several utilities such as some common Webpack modules.",checked:n.persist.ghost.generalExposeObject,onChange:r=>{n.persist.store.generalExposeObject=r,z()}}))}const U=f.findByDisplayName("FormText"),ve=f.findByDisplayName("Switch"),he=f.findByDisplayName("TextInput");f.findByDisplayName("Select",!1).SingleSelect;const G=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),be=({k:e,depends:r,children:s})=>c.default.createElement("div",{style:G(r)},c.default.createElement(ve,{checked:n.persist.ghost[e],disabled:r!==void 0&&!n.persist.ghost[r],onChange:l=>n.persist.store[e]=l}),c.default.createElement(U,{children:s})),ge=({k:e,depends:r,children:s})=>c.default.createElement("div",{style:G(r)},c.default.createElement(he,{value:n.persist.ghost[e],disabled:r!==void 0&&!n.persist.ghost[r],onChange:l=>n.persist.store[e]=l}),c.default.createElement(U,{children:s})),Ee=e=>r=>(T.useNest(n.persist),e(r)),Se=(e,r=n.persist)=>{for(const s in e)r.ghost[s]===void 0&&(r.store[s]=e[s])};function y({k:e,depends:r,children:s}){return t.createElement("div",{class:"beef-meddle-persist-textbox-wrapper"},t.createElement(ge,{k:e,depends:r},s))}function w({k:e,depends:r,children:s}){return t.createElement("div",{class:"beef-meddle-persist-switch-wrapper"},t.createElement(be,{k:e,depends:r},s))}function ye(e){return t.createElement("div",null,t.createElement("div",{class:"beef-meddle-column"},t.createElement(w,{k:"dispatchLogEnabled"},"Log all FluxDispatcher calls to console"),t.createElement(w,{k:"dispatchWhiteListMode"},"Dispatch logger whitelist mode")),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-column"},t.createElement(y,{k:"dispatchIgnoreList"},"FluxDispatcher calls to hide when not in whitelist mode (comma separated)"),t.createElement(y,{k:"dispatchWhiteList"},"FluxDispatcher calls to allow when in whitelist mode (comma separated)")))}function we({text:e,color:r,size:s,look:l,func:o,style:k}){return t.createElement(d,{style:k,color:d.Colors[r]||d.Colors.BRAND,size:d.Sizes[s]||d.Sizes.SMALL,look:d.Looks[l]||d.Looks.FILLED,onClick:o},e)}function xe(e){return t.createElement("div",null,t.createElement(y,{k:"serverId"},"Server ID"),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{class:"beef-meddle-row"},t.createElement(w,{k:"serverLurkMode"},"Join as lurker"),t.createElement(we,{style:{marginLeft:"auto"},text:"Join",size:"SMALL",func:async()=>{te(n.persist.ghost.serverId,{lurker:n.persist.ghost.serverLurkMode})}})))}const i=H.nests.make({overrides:{title:{value:"",enabled:!1},artists:{value:"",enabled:!1},album:{value:"",enabled:!1},cover:{value:"",enabled:!1},time:{position:0,duration:0,enabled:!1}}});function V(e){i.store.playerState=e,e?.item&&(i.ghost.overrides.title.enabled||(i.store.overrides.title.value=i.ghost.playerState.item.name),i.ghost.overrides.artists.enabled||(i.store.overrides.artists.value=i.ghost.playerState.item.artists.map(r=>r.name).join(", ")),i.ghost.overrides.album.enabled||(i.store.overrides.album.value=i.ghost.playerState.item.album.name),i.ghost.overrides.cover.enabled||(i.store.overrides.cover.value=i.ghost.playerState.item.album.images[0].url),i.ghost.overrides.time.enabled||(i.store.overrides.time.position=i.ghost.playerState.progress_ms,i.store.overrides.time.duration=i.ghost.playerState.item.duration_ms))}function ke(){return D(),g.instead("handleEvent",ne.prototype,([e],r)=>{if(e.type==="PLAYER_STATE_CHANGED"&&e.event!==null){if(V(e.event?.state),i.ghost.overrides.title.enabled&&(e.event.state.item.name=i.ghost.overrides.title.value),i.ghost.overrides.artists.enabled){const s=i.ghost.overrides.artists.value.split(",").map(o=>o.trim()),l=e.event.state.item.artists;for(const o in s)l[o]||(l[o]={}),l[o].name=s[o];l.length>s.length&&l.splice(s.length,l.length-s.length)}i.ghost.overrides.album.enabled&&(e.event.state.item.album.name=i.ghost.overrides.album.value),i.ghost.overrides.cover.enabled&&(e.event.state.item.album.images[0].url=i.ghost.overrides.cover.value),i.ghost.overrides.time.enabled&&(e.event.state.item.duration_ms=i.ghost.overrides.time.duration,e.event.state.progress_ms=i.ghost.overrides.time.position)}r.apply(this,[e])})}function D(){const e=N()?.socket;e&&ie.get(e.accountId,e.accessToken,{url:le.PLAYER}).then(r=>V(r?.body))}function Le(){const e=N()?.socket;e&&e.handleEvent({type:"PLAYER_STATE_CHANGED",event:{state:i.ghost.playerState}})}function Te(){T.useNest(i);const[e,r]=t.useState(x(i.ghost.overrides.time.duration)),[s,l]=t.useReducer(a=>~a,0),[o,k]=t.useReducer(a=>~a,0);return t.useEffect(()=>{function a(){l()}function P(We,{path:Ge,value:Ve}){Ge.join(".")==="overrides.time.duration"&&!i.ghost.overrides.time.enabled&&r(x(Ve)),k()}return b.FluxDispatcher.subscribe("SPOTIFY_PLAYER_STATE",a),i.on("SET",P),()=>{b.FluxDispatcher.unsubscribe("SPOTIFY_PLAYER_STATE",a),i.off("SET",P)}},[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"beef-meddle-spotify"},t.createElement("img",{className:"beef-meddle-spotify-cover",src:i.ghost.overrides.cover.value}),t.createElement("div",{className:"beef-meddle-spotify-details"},t.createElement(v,{id:"title"},"Title"),t.createElement(v,{id:"artists"},"Artists (comma-separated)"),t.createElement(v,{id:"album"},"Album"))),t.createElement(p,null,"Progress"),t.createElement(ee,{className:"beef-meddle-spotify-slider-input",minValue:0,maxValue:i.ghost.overrides.time.duration,initialValue:i.store.overrides.time.position,handleSize:1,keyboardStep:1,onValueChange:a=>i.store.overrides.time.position=Math.floor(a||0),onValueRender:$,onMarkerRender:$,disabled:!i.ghost.overrides.time.enabled,key:o}),t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(p,null,"Duration (formatted as mm:ss)"),t.createElement("div",null,t.createElement(S,{className:"beef-meddle-spotify-override-input",value:e,onChange:r,onBlur:()=>r(x(i.store.overrides.time.duration=Ae(e))),disabled:!i.ghost.overrides.time.enabled}),t.createElement(E,{checked:i.ghost.overrides.time.enabled,onChange:a=>i.store.overrides.time.enabled=a}))),t.createElement(v,{id:"cover"},"Cover URL"),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement("div",{className:"beef-meddle-spotify-post-divider"},t.createElement("div",{className:"beef-meddle-spotify-actions"},t.createElement(d,{size:d.Sizes.SMALL,onClick:()=>Le()},"Force update"),t.createElement(d,{size:d.Sizes.SMALL,onClick:()=>D()},"Refresh data")),oe()&&t.createElement("div",{className:`beef-meddle-spotify-preview ${[M.userPopout,M.body,C.scrollerBase,C.thin,I.bodyInnerWrapper,I.activity,B.activityUserPopout].join(" ")}`},t.createElement(Z,{key:s,type:"UserPopout",user:O(),activity:re(a=>a.type===se.LISTENING)}))))}function $(e){return`${Math.floor(e/6e4)}m${Intl.NumberFormat(void 0,{minimumIntegerDigits:2}).format(Math.floor(e/1e3%60))}s`}function x(e){return`${Math.floor(e/6e4)}:${Intl.NumberFormat(void 0,{minimumIntegerDigits:2}).format(Math.floor(e/1e3%60))}`}function Ae(e){const r=Me(e.split(":").filter(s=>!!s).map(s=>parseInt(s)),2);return(r[0]*60+r[1])*1e3||1e3}const Me=(e,r)=>Array(r).fill(0).concat(e).slice(-Math.max(r,e.length));function v(e){return t.createElement("div",{className:"beef-meddle-spotify-override"},t.createElement(p,null,e.children),t.createElement("div",null,t.createElement(S,{className:"beef-meddle-spotify-override-input",value:i.ghost.overrides[e.id].value,onChange:r=>i.store.overrides[e.id].value=r,disabled:!i.ghost.overrides[e.id].enabled}),t.createElement(E,{checked:i.ghost.overrides[e.id].enabled,onChange:r=>i.store.overrides[e.id].enabled=r})))}function Ie({object:e}){return typeof e=="object"?t.createElement("div",null,t.createElement("div",{className:"beef-meddle-column"},Object.entries(e).map(([r,s])=>{let l;switch(typeof s){case"string":l=s.length>0?s:"empty string";break;case"number":l=s.toString();break;case"boolean":l=s.toString();break;case"object":l=JSON.stringify(s);break;case"undefined":l="undefined"}return t.createElement("div",null,t.createElement(p,{style:{textTransform:"none",userSelect:"all"},tag:"h4"},t.createElement("code",null,r)),t.createElement(m,{style:{userSelect:"all"}},t.createElement("code",null,l)))}))):t.createElement(m,null,"Unable to resolve given snowflake.")}function Ce({value:e,onChange:r,variant:s="column",fixedWidth:l,children:o}){if(s!=="column"&&s!=="row")throw new Error("Component Error - Textbox: variant should be column (default) or row");return t.createElement("div",{class:s==="column"?"beef-meddle-column":"beef-meddle-row beef-meddle-center"},t.createElement(m,{style:l?{width:l}:{}},o),t.createElement(S,{value:e,onChange:r}))}function Ne(e){const r=R(e);if(r)return r;const s=F(e);if(s)return s;const l=j(e);if(l)return l}function Fe(e){let[r,s]=t.useState("");return t.createElement("div",null,t.createElement(Ce,{value:r,onChange:l=>{s(l)}},"Snowflake (can be the ID of a user, guild or channel)"),t.createElement(u,{className:"beef-meddle-divider"}),t.createElement(Ie,{object:Ne(r)}))}function je(e){return t.createElement(L.ErrorBoundary,null,t.createElement("div",{className:"beef-meddle-settings"},t.createElement(ue,{items:[{text:"General",component:pe},{text:"FluxDispatcher",component:ye},{text:"Servers",component:xe},{text:"Spotify",component:Te},{text:"Snowflake",component:Fe}]})))}var _e=()=>J.registerSection("MEDDLE","Meddle",Ee(je));function Oe(){return g.after("dispatch",b.FluxDispatcher,e=>{!n.persist.ghost.dispatchLogEnabled||n.persist.ghost.dispatchWhiteListMode&&!n.persist.ghost.dispatchWhiteList.split(",").includes(e[0].type)||n.persist.ghost.dispatchIgnoreList.split(",").includes(e[0].type)||console.log(e[0])})}var Re=()=>g.injectCSS(".beef-meddle-row{display:flex;gap:.5rem}.beef-meddle-column{display:flex;flex-direction:column;gap:.5rem}.beef-meddle-divider{margin-top:.5rem;margin-bottom:.5rem}.beef-meddle-subtext{font-size:x-small;color:var(--text-muted)}.beef-meddle-card{padding:1rem;border-radius:.5rem;background-color:var(--background-secondary)}.beef-meddle-center{display:flex;justify-content:center;align-items:center}.beef-meddle-fullwidth,.beef-meddle-fullwidth *{width:100%}.beef-meddle-persist-textbox-wrapper *{display:flex;flex-direction:column-reverse}.beef-meddle-persist-textbox-wrapper * *{width:100%}.beef-meddle-persist-switch-wrapper{display:flex}.beef-meddle-persist-switch-wrapper *{margin-bottom:0!important;align-items:center}.beef-meddle-switch{display:flex;align-items:center;gap:.5rem}.beef-meddle-spotify{display:flex;align-items:center}.beef-meddle-spotify-cover{width:120px;height:120px}.beef-meddle-spotify-details{margin-left:10px;width:100%}.beef-meddle-spotify-override{margin-bottom:8px}.beef-meddle-spotify-override div{display:flex;align-items:center}.beef-meddle-spotify-override input{width:100%}.beef-meddle-spotify-override-input{flex-grow:1;margin-right:12px}.beef-meddle-spotify-post-divider{display:flex}.beef-meddle-spotify-actions{display:block}.beef-meddle-spotify-actions button{margin-bottom:8px;width:100%}.beef-meddle-spotify-preview{width:300px;padding-top:16px;margin-left:auto}.beef-meddle-spotify-preview div img{top:16px!important;right:16px!important}");Se({dispatchLogEnabled:!1,dispatchIgnoreList:"",dispatchWhiteList:"",dispatchWhiteListMode:!1,serverId:"",serverLurkMode:!1,generalExposeObject:!0});const ze=[z(),_e(),Oe(),ke(),Re()];function Ue(){_.forEachRight(ze,e=>e())}return h.onUnload=Ue,Object.defineProperty(h,"__esModule",{value:!0}),h})({},cumcord.pluginData,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.React,cumcord.ui.components,cumcord.utils,cumcord.plugins,cumcord.modules.common.React,cumcord.modules.internal,cumcord.ui.userSettings);
